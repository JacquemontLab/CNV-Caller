Bootstrap: docker
From: mambaorg/micromamba:2-ubuntu22.04

%labels
    Maintainer Benjamin Clark
    Description "Micromamba-based container for running compile_pfb.py script"

%post
    # Update base system
    apt-get update && apt-get install -y --no-install-recommends \
        procps \
        && apt-get clean && rm -rf /var/lib/apt/lists/*

    # Install Python packages with micromamba
    micromamba install -y -n base -c conda-forge \
        python=3.11 \
        polars \
        duckdb \
        psutil \
        && micromamba clean --all --yes

%environment
    # Ensure micromamba environment is active by default
    export MAMBA_ROOT_PREFIX=/opt/conda
    export PATH=$MAMBA_ROOT_PREFIX/bin:$PATH